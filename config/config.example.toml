# Email categorise / triage configuration
# Copy to config.toml and edit.

[auth]
# auth_mode:
# - "application": daemon / cron friendly (no browser login). Uses client credentials and Graph .default scope.
# - "delegated": interactive login on first use, then cached tokens (requires a browser).
auth_mode = "application"

# Token cache (shared by MSAL). Stored under ./data by default.
token_cache_path = "./data/msal_token_cache.bin"

[azure]
# Public/Confidential app ID (Entra ID App registration -> Application (client) ID)
client_id = "YOUR_CLIENT_ID"

# Default tenant. For single-tenant setups, set this to your tenant GUID.
# For multi-tenant delegated use, "organizations" can work, but for application auth you generally
# want the real tenant ID per org.
tenant_id = "YOUR_TENANT_ID_OR_organizations"

# For application auth, set client secret via env var (do NOT commit secrets).
# The tool reads the secret from this env var name:
client_secret_env = "MS_GRAPH_CLIENT_SECRET"

# Delegated scopes (ONLY used if auth_mode="delegated")
# IMPORTANT: do NOT include openid/profile/offline_access here; MSAL treats them as reserved and will error.
delegated_scopes = [
  "Mail.ReadWrite",
  "Mail.Send"
]

[triage]
lookback_days_initial = 60
lookback_days_incremental = 3
max_messages_per_run = 40

# Tone profiling: Sent Items lookback for building tone profiles
tone_profile_lookback_days = 120

# Features
# These are defaults; per-account overrides are supported under [[accounts]].triage_overrides
draft_replies = false
create_tasks = false
send_summary_email = false
log_to_file = true

# Optional summary email settings (requires Mail.Send)
summary_email_to = "lewis@colemanbros.co.uk"
# Which account should send summaries (must be in [[accounts]])
summary_email_from_account = "lewis@colemanbros.co.uk"

# Per-priority read/unread handling (true = mark read after processing; false = leave unread)
[triage.priority_read_state]
default = false
"Urgent" = false
"Priority 1" = false
"Priority 2" = false
"Priority 3" = false
"Marketing" = true
"Informational" = false
"Complete" = true
"Possibly Complete" = true

[llm]
# LLM provider for triage + tone profiling + drafting.
#
# provider:
# - "codex": use Codex CLI (recommended). No API key needed if Codex is authenticated already.
# - "codex-oss": use Codex CLI with --oss (routes to local provider, requires Ollama).
provider = "codex"

# Codex-only models (work with ChatGPT credits + codex exec)
# Balanced cost/speed: mini for triage, max for replies.
triage_model = "gpt-5.1-codex-mini"
reply_model  = "gpt-5.1-codex-max"

# Cheaper/faster (lowest cost, lowest quality):
# triage_model = "gpt-5.1-codex-mini"
# reply_model  = "gpt-5.1-codex-mini"

# More accurate (slower/costlier):
# triage_model = "gpt-5.1-codex-max"
# reply_model  = "gpt-5.1-codex-max"

# If provider="codex-oss", you can use local models via Ollama.
# Example:
# provider = "codex-oss"
# triage_model = "llama3.1"
# reply_model  = "llama3.1"

# If provider="codex-oss", you can use local models via Ollama.
# Example:
# provider = "codex-oss"
# triage_model = "llama3.1"
# reply_model  = "llama3.1"

[[accounts]]
email = "lewis@colemanbros.co.uk"
label = "primary"
# Optional override if this mailbox is in a different tenant:
# tenant_id = "YOUR_TENANT_GUID"

# [[accounts]]
# email = "other@another-tenant.com"
# label = "other-org"
# tenant_id = "OTHER_TENANT_GUID"

# Example with per-account overrides:
[[accounts]]
email = "client-mailbox@example.com"
label = "client-org"

# Optional: override tenant/app credentials for this account
[accounts.azure_overrides]
client_id = "CLIENT_APP_ID"
tenant_id = "CLIENT_TENANT_ID"
# If the secret env var differs for this account:
client_secret_env = "CLIENT_MS_GRAPH_SECRET"
# Optional per-account delegated scopes (only if auth_mode=\"delegated\")
# delegated_scopes = ["Mail.ReadWrite", "Mail.Send"]

# Optional: per-account behaviour toggles (fall back to [triage] defaults)
[accounts.triage_overrides]
draft_replies = true
create_tasks = true
send_summary_email = true
log_to_file = true
summary_email_to = "ops@example.com"
summary_email_from_account = "client-mailbox@example.com"
  [accounts.triage_overrides.priority_read_state]
  "Priority 1" = false
  "Priority 2" = true   # Example: auto-mark P2 as read for this account
